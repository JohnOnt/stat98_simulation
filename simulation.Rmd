---
title: "R Notebook"
output:
  pdf_document: default
  pdf: default
---

```{r}
lambda <- 1/900
sims <- 800
n <- 15
tsamples <- replicate(sims, rexp(n, rate = lambda))
mu = 1/lambda

results <- as.numeric(sims)
t.int <- matrix(FALSE, sims, 2)
for (i in 1:sims) {
    t.int[i, ] <- t.test(tsamples[, i], conf.level = 0.95)$conf.int
    results[i] <- t.int[i, 1] < mu & t.int[i, 2] > mu
}
sum(results)/sims
```

```{r}
# Define functions for calculating estimates (to simplify code)

# For Normal and Poisson
get_estimate_NormPois <- function(data, indices) {
  return(mean(data[indices]))
}

# For Binomial Distribution
get_estimate_Binom <- function(data, indices) {
  return(mean(data[indices])/length(data[indices]))
}

# For Geometric Distribution
get_estimate_Geom <- function(data, indices) {
  return(1/mean(data[indices]))
}
```

```{r}
# Generate Da DATA
# FIVE Distributions
# Normal, Poisson, Binomial, Geometric, ¯\_(ツ)_/¯ distribution
n <- 100
normies <- rnorm(n) # continous and normal
poissis <- rpois(n, 2) # Continuous not normal
binnies <- rbinom(n, n, 0.7) # discrete normalish
geomies <- rgeom(n, 0.7) # discrete abnormal
```

```{r}
# T-test confidence intervals
```

```{r}
library(boot)

boot_out <- boot(
  data =normies,
  statistic = get_estimate_NormPois,
  R = 100
)

boot.ci(boot_out)
boot.ci(boot_out, type = "basic") # Bias corrected bootstrap
boot.ci(boot_out, type = "perc") # Standard bootstrap 
boot.ci(boot_out, type = "norm") # Parametric (standard normal)
```
```{r}
boot.ci(boot_out)$basic[5]
```

```{r}
library(kernelboot)

b1 <- kernelboot(data=normies, statistic=get_estimate_NormPois)
summary(b1)

summary(b1)[3]
```


```{r, warning = F}
# Create variables
nsims = 100
n = c(10, 30, 100)
mu = 0
coverage = c()
normies_coverage <- matrix(nrow = 100, ncol = 15)

for (i in 1:nsims) {
  normies10 = rnorm(10)
  normies30 = rnorm(30)
  normies100 = rnorm(100)
  
  normies10.boot <- boot(
      data = normies10,
      statistic = get_estimate_NormPois,
      R = 100
  )
  
  normies30.boot <- boot(
      data = normies30,
      statistic = get_estimate_NormPois,
      R = 100
  )
  
  normies100.boot <- boot(
      data = normies100,
      statistic = get_estimate_NormPois,
      R = 100
  )
  
  # Initialize row vector
  cov.i <- c()
  
  results <- as.numeric(nsims)
  t.int <- matrix(FALSE, sims, 2)

  lower10t <- t.test(normies10, conf.level = 0.95)$conf.int[1]
  upper10t <- t.test(normies10, conf.level = 0.95)$conf.int[2]
  
  lower30t <- t.test(normies30, conf.level = 0.95)$conf.int[1]
  upper30t <- t.test(normies30, conf.level = 0.95)$conf.int[2]
  
  lower100t <- t.test(normies100, conf.level = 0.95)$conf.int[1]
  upper100t <- t.test(normies100, conf.level = 0.95)$conf.int[2]
    
  cov.i <- c(cov.i, as.numeric((lower10t <= mu & upper10t >= mu)),
            (lower30t <= mu & upper30t >= mu),
            (lower100t <= mu & upper100t >= mu))
  
  
  
  # T-test
  # cov.i <- c(cov.i, 1, 1, 1)
  
  # Booting types
  
  boot_types <- c("perc", "basic", "norm")
  
  for (j in 1:(length(boot_types))) {
    # print(boot_types[j])
    subt <- 0
    if (boot_types[j] == "norm") {subt = 2}
    lower10 = boot.ci(normies10.boot, type = boot_types[j])[[4]][4-subt]
    upper10 = boot.ci(normies10.boot, type = boot_types[j])[[4]][5-subt]
    
    lower30 = boot.ci(normies30.boot, type = boot_types[j])[[4]][4-subt]
    upper30 = boot.ci(normies30.boot, type = boot_types[j])[[4]][5-subt]
    
    lower100 = boot.ci(normies100.boot, type = boot_types[j])[[4]][4-subt]
    upper100 = boot.ci(normies100.boot, type = boot_types[j])[[4]][5-subt]
    
    cov.i <- c(cov.i, (lower10 <= mu & upper10 >= mu),
               (lower30 <= mu & upper30 >= mu),
               (lower100 <= mu & upper100 >= mu))
  }
  
  boot10 <- kernelboot(data=normies10, statistic=get_estimate_NormPois)
  lower10 <- summary(boot10)[3]; upper10 <- summary(boot10)[5]
  
  boot30 <- kernelboot(data=normies30, statistic=get_estimate_NormPois)
  lower30 <- summary(boot30)[3]; upper30 <- summary(boot30)[5]
  
  boot100 <- kernelboot(data=normies100, statistic=get_estimate_NormPois)
  lower100 <- summary(boot100)[3]; upper100 <- summary(boot100)[5]
  
  cov.i <- c(cov.i, (lower10 <= mu & upper10 >= mu),
               (lower30 <= mu & upper30 >= mu),
               (lower100 <= mu & upper100 >= mu))
  
  normies_coverage[i,] <- cov.i
  
  # boot.ci(normies10boot, type = "perc")[[4]][5]
  
  
  
  # coverage[i] = lower <= mu & upper >= mu
  # normies_coverage[,1] = lower <= mu & upper >= mu
  }
  #normies_coverage[1] = mean(coverage)

# part (i)

for (i in 1:ncol(normies_coverage)) {
  print(mean(normies_coverage[,i])) 
  }
  

```

